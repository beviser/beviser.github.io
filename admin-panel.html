<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LDP TOOLS - Admin Panel</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="light-beam"></div>
        <div class="light-beam"></div>
        <div class="light-beam"></div>
    </div>

    <!-- Header -->
    <header class="main-header">
        <div class="menu-icon" id="menuIcon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <a href="home.html" class="logo">LDP TOOLS</a>
        <div class="user-info">
            <span class="username" id="headerUsername">Admin</span>
            <div class="balance-box" id="headerBalance">100,000,000ƒë</div>
        </div>
    </header>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <ul>
            <li onclick="window.location.href='home.html'">
                <i>üè†</i> Trang ch·ªß
            </li>
            <li onclick="window.location.href='#account'">
                <i>üë§</i> Ki·ªÉm tra t√†i kho·∫£n
            </li>
            <li onclick="window.location.href='deposit.html'">
                <i>üí∞</i> N·∫°p ti·ªÅn
            </li>
            <li onclick="showHistory()">
                <i>üìú</i> L·ªãch s·ª≠ mua
            </li>
            <li onclick="window.location.href='admin-panel.html'">
                <i>‚öôÔ∏è</i> Control Panel
            </li>
            <li onclick="logout()">
                <i>üö™</i> ƒêƒÉng xu·∫•t
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="admin-container">
            <div class="admin-header">
                <h1 class="admin-title">CONTROL PANEL</h1>
                <p class="admin-subtitle">Qu·∫£n l√Ω h·ªá th·ªëng LDP Tools</p>
            </div>

            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">T·ªïng ng∆∞·ªùi d√πng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">0ƒë</div>
                    <div class="stat-label">T·ªïng doanh thu</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeTools">0</div>
                    <div class="stat-label">Tool ƒëang ho·∫°t ƒë·ªông</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalVouchers">0</div>
                    <div class="stat-label">M√£ gi·∫£m gi√°</div>
                </div>
            </div>

            <!-- Admin Panels Grid -->
            <div class="admin-grid">
                <!-- User Management Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üë•</div>
                        <h3 class="panel-title">Danh S√°ch User</h3>
                    </div>
                    <div class="user-list" id="userList">
                        <div class="empty-state">
                            <div class="empty-icon">üë§</div>
                            <div class="empty-title">Ch∆∞a c√≥ ng∆∞·ªùi d√πng</div>
                        </div>
                    </div>
                </div>

                <!-- Transfer Money Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üí∏</div>
                        <h3 class="panel-title">Chuy·ªÉn Ti·ªÅn Cho User</h3>
                    </div>
                    <form class="admin-form" id="transferForm">
                        <div class="form-group">
                            <label>T√™n t√†i kho·∫£n ng∆∞·ªùi nh·∫≠n</label>
                            <input type="text" class="admin-input" id="transferUsername" placeholder="Nh·∫≠p username" required>
                        </div>
                        <div class="form-group">
                            <label>S·ªë ti·ªÅn chuy·ªÉn</label>
                            <input type="number" class="admin-input" id="transferAmount" placeholder="Nh·∫≠p s·ªë ti·ªÅn" min="1000" required>
                        </div>
                        <button type="submit" class="submit-btn">üí∞ Chuy·ªÉn ti·ªÅn ngay</button>
                    </form>
                </div>

                <!-- Ban User Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üö´</div>
                        <h3 class="panel-title">Ban User</h3>
                    </div>
                    <form class="admin-form" id="banForm">
                        <div class="form-group">
                            <label>T√™n t√†i kho·∫£n c·∫ßn ban</label>
                            <input type="text" class="admin-input" id="banUsername" placeholder="Nh·∫≠p username" required>
                        </div>
                        <div class="form-group">
                            <label>L√Ω do ban</label>
                            <textarea class="admin-input" id="banReason" placeholder="Nh·∫≠p l√Ω do..." rows="3"></textarea>
                        </div>
                        <button type="submit" class="submit-btn" style="background: var(--error-red);">üö´ Ban user n√†y</button>
                    </form>
                </div>

                <!-- Create Voucher Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üé´</div>
                        <h3 class="panel-title">T·∫°o M√£ Gi·∫£m Gi√°</h3>
                    </div>
                    <form class="admin-form" id="voucherForm">
                        <div class="form-group">
                            <label>Ch·ªçn tool</label>
                            <select class="admin-select" id="voucherTool" required>
                                <option value="toolv1">Tool V1</option>
                                <option value="toolmd5">Tool MD5</option>
                                <option value="toolsicbo">Tool Sicbo</option>
                                <option value="all">T·∫•t c·∫£ tools</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ph·∫ßn trƒÉm gi·∫£m gi√° (%)</label>
                            <input type="number" class="admin-input" id="voucherDiscount" placeholder="Nh·∫≠p % gi·∫£m gi√°" min="1" max="100" required>
                        </div>
                        <div class="form-group">
                            <label>Ng√†y h·∫øt h·∫°n</label>
                            <input type="date" class="admin-input" id="voucherExpiry" required>
                        </div>
                        <div class="form-group">
                            <label>S·ªë l∆∞·ª£t s·ª≠ d·ª•ng t·ªëi ƒëa</label>
                            <input type="number" class="admin-input" id="voucherMaxUses" placeholder="Nh·∫≠p s·ªë l∆∞·ª£t" min="1" required>
                        </div>
                        <button type="submit" class="submit-btn">üé´ T·∫°o voucher</button>
                    </form>
                </div>

                <!-- Voucher List Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üìã</div>
                        <h3 class="panel-title">Danh S√°ch Voucher</h3>
                    </div>
                    <div class="voucher-list" id="voucherList">
                        <div class="empty-state">
                            <div class="empty-icon">üé´</div>
                            <div class="empty-title">Ch∆∞a c√≥ voucher n√†o</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div class="notification-icon">‚úì</div>
        <div class="notification-content">
            <div class="notification-title">Th√¥ng b√°o</div>
            <div class="notification-message">Message here</div>
        </div>
    </div>

    <script>
        // =============================================
        // ADMIN PANEL - HO√ÄN CH·ªàNH V·ªöI T·∫§T C·∫¢ T√çNH NƒÇNG
        // =============================================

        // Bi·∫øn to√†n c·ª•c
        let currentUsers = [];
        let currentVouchers = [];

        // Kh·ªüi t·∫°o khi trang load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ ADMIN PANEL - INITIALIZING...');
            
            // Ki·ªÉm tra ƒëƒÉng nh·∫≠p v√† quy·ªÅn admin
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser || !currentUser.isAdmin) {
                alert('‚ö†Ô∏è B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p admin panel!');
                window.location.href = 'index.html';
                return;
            }
            
            console.log('‚úÖ Admin user authenticated:', currentUser.username);
            
            // Kh·ªüi t·∫°o d·ªØ li·ªáu n·∫øu ch∆∞a c√≥
            initializeData();
            
            // C·∫≠p nh·∫≠t giao di·ªán
            updateHeaderInfo(currentUser);
            initSidebar();
            loadAdminData();
            setupEventListeners();
            
            console.log('üéØ ADMIN PANEL READY');
        });

        // Kh·ªüi t·∫°o d·ªØ li·ªáu
        function initializeData() {
            // Kh·ªüi t·∫°o users n·∫øu ch∆∞a c√≥
            if (!localStorage.getItem('users')) {
                const users = [
                    {
                        username: 'bevis',
                        password: 'leduc',
                        balance: 100000000,
                        isAdmin: true,
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('users', JSON.stringify(users));
                console.log('üìù Initialized default admin user');
            }
            
            // Kh·ªüi t·∫°o tools n·∫øu ch∆∞a c√≥
            if (!localStorage.getItem('tools')) {
                const tools = {
                    'toolv1': { active: false, expiry: null, key: null },
                    'toolmd5': { active: false, expiry: null, key: null },
                    'toolsicbo': { active: false, expiry: null, key: null }
                };
                localStorage.setItem('tools', JSON.stringify(tools));
            }
            
            // Kh·ªüi t·∫°o vouchers n·∫øu ch∆∞a c√≥
            if (!localStorage.getItem('vouchers')) {
                localStorage.setItem('vouchers', JSON.stringify([]));
            }
        }

        // C·∫≠p nh·∫≠t header
        function updateHeaderInfo(user) {
            const usernameEl = document.getElementById('headerUsername');
            const balanceEl = document.getElementById('headerBalance');
            
            if (usernameEl) usernameEl.textContent = user.username;
            if (balanceEl) balanceEl.textContent = formatCurrency(user.balance);
        }

        // Kh·ªüi t·∫°o sidebar
        function initSidebar() {
            const menuIcon = document.getElementById('menuIcon');
            const sidebar = document.getElementById('sidebar');
            
            if (menuIcon && sidebar) {
                menuIcon.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                });
            }
        }

        // Thi·∫øt l·∫≠p event listeners
        function setupEventListeners() {
            // Form chuy·ªÉn ti·ªÅn
            const transferForm = document.getElementById('transferForm');
            if (transferForm) {
                transferForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleTransfer();
                });
            }
            
            // Form ban user
            const banForm = document.getElementById('banForm');
            if (banForm) {
                banForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleBanUser();
                });
            }
            
            // Form t·∫°o voucher
            const voucherForm = document.getElementById('voucherForm');
            if (voucherForm) {
                // Set min date to today
                const today = new Date().toISOString().split('T')[0];
                document.getElementById('voucherExpiry').min = today;
                
                voucherForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    handleCreateVoucher();
                });
            }
        }

        // T·∫£i d·ªØ li·ªáu admin
        function loadAdminData() {
            console.log('üìä Loading admin data...');
            loadUsersList();
            loadVouchers();
            updateStats();
        }

        // T·∫£i danh s√°ch user - ƒê√É S·ª¨A HO√ÄN TO√ÄN
        function loadUsersList() {
            console.log('üë• Loading users list...');
            
            // ƒê·ªçc tr·ª±c ti·∫øp t·ª´ localStorage
            currentUsers = JSON.parse(localStorage.getItem('users')) || [];
            const userList = document.getElementById('userList');
            
            if (!userList) {
                console.error('‚ùå User list element not found!');
                return;
            }
            
            userList.innerHTML = '';
            
            console.log('üìä Total users in system:', currentUsers.length);
            console.log('üë• All users:', currentUsers);
            
            // L·ªçc ch·ªâ user th∆∞·ªùng (kh√¥ng ph·∫£i admin)
            const regularUsers = currentUsers.filter(user => !user.isAdmin);
            
            console.log('üë§ Regular users found:', regularUsers.length);
            
            if (regularUsers.length === 0) {
                userList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üë§</div>
                        <div class="empty-title">Ch∆∞a c√≥ ng∆∞·ªùi d√πng th∆∞·ªùng</div>
                        <div class="empty-description">
                            T·ªïng user trong h·ªá th·ªëng: ${currentUsers.length}<br>
                            Hi·ªán ch·ªâ c√≥ t√†i kho·∫£n admin
                        </div>
                    </div>
                `;
                return;
            }
            
            // Hi·ªÉn th·ªã t·ª´ng user
            regularUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <div class="user-details">
                        <div class="user-name">${user.username}</div>
                        <div class="user-balance">${formatCurrency(user.balance)}</div>
                        <div class="user-date">ƒêƒÉng k√Ω: ${new Date(user.createdAt).toLocaleDateString('vi-VN')}</div>
                    </div>
                    <div class="user-actions">
                        <button class="action-btn edit" onclick="editUser('${user.username}')">S·ª≠a</button>
                        <button class="action-btn delete" onclick="deleteUser('${user.username}')">X√≥a</button>
                    </div>
                `;
                userList.appendChild(userItem);
            });
            
            console.log('‚úÖ Users list loaded successfully');
        }

        // T·∫£i danh s√°ch voucher
        function loadVouchers() {
            currentVouchers = JSON.parse(localStorage.getItem('vouchers')) || [];
            const voucherList = document.getElementById('voucherList');
            
            if (!voucherList) return;
            
            voucherList.innerHTML = '';
            
            if (currentVouchers.length === 0) {
                voucherList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üé´</div>
                        <div class="empty-title">Ch∆∞a c√≥ voucher n√†o</div>
                    </div>
                `;
                return;
            }
            
            currentVouchers.forEach((voucher, index) => {
                const isExpired = new Date(voucher.expiry) < new Date();
                const voucherItem = document.createElement('div');
                voucherItem.className = 'voucher-item';
                voucherItem.style.border = isExpired ? '1px solid var(--error-red)' : '1px solid var(--glass-border)';
                voucherItem.innerHTML = `
                    <div class="voucher-code">${voucher.code}</div>
                    <div class="voucher-info">
                        <span>Tool: ${voucher.tool}</span>
                        <span class="voucher-discount">Gi·∫£m ${voucher.discount}%</span>
                    </div>
                    <div class="voucher-info">
                        <span>H·∫øt h·∫°n: ${new Date(voucher.expiry).toLocaleDateString('vi-VN')}</span>
                        <span class="voucher-expires" style="color: ${isExpired ? 'var(--error-red)' : 'var(--success-green)'}">
                            ${isExpired ? 'ƒê√£ h·∫øt h·∫°n' : 'C√≤n hi·ªáu l·ª±c'}
                        </span>
                    </div>
                    <div class="voucher-usage">ƒê√£ s·ª≠ d·ª•ng: ${voucher.usedCount}/${voucher.maxUses}</div>
                    <button class="delete-voucher-btn" onclick="deleteVoucher(${index})">X√≥a voucher</button>
                `;
                voucherList.appendChild(voucherItem);
            });
        }

        // C·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const tools = JSON.parse(localStorage.getItem('tools')) || {};
            const vouchers = JSON.parse(localStorage.getItem('vouchers')) || [];
            
            const totalUsers = users.filter(u => !u.isAdmin).length;
            
            let totalRevenue = 0;
            users.forEach(user => {
                if (!user.isAdmin) {
                    totalRevenue += user.balance;
                }
            });
            
            const activeTools = Object.values(tools).filter(tool => tool.active && tool.expiry > Date.now()).length;
            const totalVouchers = vouchers.length;
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('activeTools').textContent = activeTools;
            document.getElementById('totalVouchers').textContent = totalVouchers;
        }

        // X·ª≠ l√Ω chuy·ªÉn ti·ªÅn - ƒê√É S·ª¨A HO√ÄN TO√ÄN
        function handleTransfer() {
            console.log('üí∏ Processing transfer...');
            
            const username = document.getElementById('transferUsername').value.trim();
            const amountInput = document.getElementById('transferAmount').value.trim();
            
            if (!username || !amountInput) {
                showNotification('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }
            
            const amount = parseInt(amountInput);
            
            if (isNaN(amount) || amount < 1000) {
                showNotification('S·ªë ti·ªÅn t·ªëi thi·ªÉu l√† 1,000ƒë!', 'error');
                return;
            }
            
            // ƒê·ªçc v√† c·∫≠p nh·∫≠t d·ªØ li·ªáu
            let users = JSON.parse(localStorage.getItem('users')) || [];
            const userIndex = users.findIndex(u => u.username === username);
            
            if (userIndex === -1) {
                showNotification('Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng!', 'error');
                return;
            }
            
            const user = users[userIndex];
            
            if (user.isAdmin) {
                showNotification('Kh√¥ng th·ªÉ chuy·ªÉn ti·ªÅn cho t√†i kho·∫£n admin!', 'error');
                return;
            }
            
            // C·ªông ti·ªÅn cho user
            const oldBalance = users[userIndex].balance;
            users[userIndex].balance += amount;
            
            console.log(`üí∞ Transfer: ${username} | ${oldBalance} + ${amount} = ${users[userIndex].balance}`);
            
            // L∆∞u v√†o localStorage
            localStorage.setItem('users', JSON.stringify(users));
            
            showNotification(`‚úÖ ƒê√£ chuy·ªÉn ${formatCurrency(amount)} cho ${username}`);
            
            // Reset form v√† c·∫≠p nh·∫≠t giao di·ªán
            document.getElementById('transferForm').reset();
            loadAdminData();
            
            // C·∫≠p nh·∫≠t header n·∫øu user ƒëang ƒëƒÉng nh·∫≠p l√† user ƒë∆∞·ª£c chuy·ªÉn ti·ªÅn
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser && currentUser.username === username) {
                currentUser.balance += amount;
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                updateHeaderInfo(currentUser);
            }
        }

        // X·ª≠ l√Ω ban user - ƒê√É S·ª¨A HO√ÄN TO√ÄN
        function handleBanUser() {
            console.log('üö´ Processing ban user...');
            
            const username = document.getElementById('banUsername').value.trim();
            const reason = document.getElementById('banReason').value.trim();
            
            if (!username) {
                showNotification('Vui l√≤ng nh·∫≠p t√™n ng∆∞·ªùi d√πng!', 'error');
                return;
            }
            
            let users = JSON.parse(localStorage.getItem('users')) || [];
            const userIndex = users.findIndex(u => u.username === username);
            
            if (userIndex === -1) {
                showNotification('Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng!', 'error');
                return;
            }
            
            const user = users[userIndex];
            
            if (user.isAdmin) {
                showNotification('Kh√¥ng th·ªÉ ban t√†i kho·∫£n admin!', 'error');
                return;
            }
            
            if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën BAN user "${username}"? H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!`)) {
                return;
            }
            
            // X√≥a user
            users.splice(userIndex, 1);
            localStorage.setItem('users', JSON.stringify(users));
            
            showNotification(`‚úÖ ƒê√£ ban user ${username}${reason ? ` v·ªõi l√Ω do: ${reason}` : ''}`);
            document.getElementById('banForm').reset();
            loadAdminData();
        }

        // X·ª≠ l√Ω t·∫°o voucher - T√çNH NƒÇNG M·ªöI
        function handleCreateVoucher() {
            console.log('üé´ Creating voucher...');
            
            const tool = document.getElementById('voucherTool').value;
            const discount = parseInt(document.getElementById('voucherDiscount').value);
            const expiry = document.getElementById('voucherExpiry').value;
            const maxUses = parseInt(document.getElementById('voucherMaxUses').value);
            
            if (!tool || !discount || !expiry || !maxUses) {
                showNotification('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }
            
            if (discount < 1 || discount > 100) {
                showNotification('Ph·∫ßn trƒÉm gi·∫£m gi√° ph·∫£i t·ª´ 1-100%!', 'error');
                return;
            }
            
            if (maxUses < 1) {
                showNotification('S·ªë l∆∞·ª£t s·ª≠ d·ª•ng ph·∫£i l·ªõn h∆°n 0!', 'error');
                return;
            }
            
            const expiryDate = new Date(expiry);
            if (expiryDate < new Date()) {
                showNotification('Ng√†y h·∫øt h·∫°n ph·∫£i l·ªõn h∆°n ng√†y hi·ªán t·∫°i!', 'error');
                return;
            }
            
            const voucher = {
                code: generateVoucherCode(),
                tool: tool,
                discount: discount,
                expiry: expiryDate.getTime(),
                maxUses: maxUses,
                usedCount: 0,
                createdAt: Date.now()
            };
            
            let vouchers = JSON.parse(localStorage.getItem('vouchers')) || [];
            vouchers.push(voucher);
            localStorage.setItem('vouchers', JSON.stringify(vouchers));
            
            showNotification(`‚úÖ ƒê√£ t·∫°o voucher: ${voucher.code} - Gi·∫£m ${discount}%`);
            document.getElementById('voucherForm').reset();
            loadVouchers();
            updateStats();
        }

        // T·∫°o m√£ voucher
        function generateVoucherCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = 'LDP-';
            for (let i = 0; i < 8; i++) {
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        // X√≥a voucher
        function deleteVoucher(index) {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a voucher n√†y?')) {
                let vouchers = JSON.parse(localStorage.getItem('vouchers')) || [];
                vouchers.splice(index, 1);
                localStorage.setItem('vouchers', JSON.stringify(vouchers));
                showNotification('‚úÖ ƒê√£ x√≥a voucher');
                loadVouchers();
                updateStats();
            }
        }

        // S·ª≠a user
        function editUser(username) {
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.username === username);
            
            if (userIndex !== -1) {
                const newBalance = prompt(`Nh·∫≠p s·ªë ti·ªÅn m·ªõi cho ${username}:`, users[userIndex].balance);
                if (newBalance !== null) {
                    const balance = parseInt(newBalance);
                    if (!isNaN(balance) && balance >= 0) {
                        users[userIndex].balance = balance;
                        localStorage.setItem('users', JSON.stringify(users));
                        showNotification(`‚úÖ ƒê√£ c·∫≠p nh·∫≠t s·ªë ti·ªÅn cho ${username}`);
                        loadAdminData();
                    } else {
                        showNotification('S·ªë ti·ªÅn kh√¥ng h·ª£p l·ªá!', 'error');
                    }
                }
            }
        }

        // X√≥a user
        function deleteUser(username) {
            if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën X√ìA user "${username}"?`)) {
                let users = JSON.parse(localStorage.getItem('users'));
                const userIndex = users.findIndex(u => u.username === username);
                
                if (userIndex !== -1) {
                    users.splice(userIndex, 1);
                    localStorage.setItem('users', JSON.stringify(users));
                    showNotification(`‚úÖ ƒê√£ x√≥a user ${username}`);
                    loadAdminData();
                }
            }
        }

        // ƒê·ªãnh d·∫°ng ti·ªÅn t·ªá
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            if (!notification) {
                alert(message);
                return;
            }
            
            const messageEl = notification.querySelector('.notification-message');
            if (!messageEl) return;
            
            messageEl.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 4000);
        }

        // ƒêƒÉng xu·∫•t
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }

        // Hi·ªÉn th·ªã l·ªãch s·ª≠
        function showHistory() {
            showNotification('T√≠nh nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...');
        }

        // =============================================
        // DEBUG FUNCTIONS - X√ìA SAU KHI CH·∫†Y ·ªîN
        // =============================================
        
        console.log('üîß DEBUG MODE ACTIVATED');

        // H√†m debug ƒë·ªÉ xem t·∫•t c·∫£ users
        function debugUsers() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            console.log('=== DEBUG USERS ===');
            console.log('Total users:', users.length);
            users.forEach((user, index) => {
                console.log(`User ${index}:`, user);
            });
            alert(`T·ªïng s·ªë user: ${users.length}\nXem chi ti·∫øt trong console (F12)`);
        }

        // H√†m reset to√†n b·ªô d·ªØ li·ªáu
        function resetAllData() {
            if (confirm('B·∫°n c√≥ ch·∫Øc mu·ªën RESET TO√ÄN B·ªò d·ªØ li·ªáu?')) {
                localStorage.clear();
                initializeData();
                alert('‚úÖ ƒê√£ reset to√†n b·ªô d·ªØ li·ªáu!');
                window.location.reload();
            }
        }

        // H√†m th√™m user test
        function addTestUser() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const testUser = {
                username: 'testuser_' + Date.now(),
                password: '123456',
                balance: 50000,
                isAdmin: false,
                createdAt: new Date().toISOString()
            };
            
            users.push(testUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            console.log('‚úÖ Added test user:', testUser);
            alert(`ƒê√£ th√™m user test: ${testUser.username}`);
            window.location.reload();
        }

        // Th√™m n√∫t debug v√†o giao di·ªán
        document.addEventListener('DOMContentLoaded', function() {
            const debugContainer = document.createElement('div');
            debugContainer.style.position = 'fixed';
            debugContainer.style.top = '10px';
            debugContainer.style.right = '10px';
            debugContainer.style.zIndex = '10000';
            debugContainer.style.display = 'flex';
            debugContainer.style.flexDirection = 'column';
            debugContainer.style.gap = '5px';
            
            const debugBtn = document.createElement('button');
            debugBtn.textContent = 'üêõ Debug Users';
            debugBtn.style.padding = '8px 12px';
            debugBtn.style.background = '#ff6b6b';
            debugBtn.style.color = 'white';
            debugBtn.style.border = 'none';
            debugBtn.style.borderRadius = '5px';
            debugBtn.style.cursor = 'pointer';
            debugBtn.onclick = debugUsers;
            
            const resetBtn = document.createElement('button');
            resetBtn.textContent = 'üîÑ Reset Data';
            resetBtn.style.padding = '8px 12px';
            resetBtn.style.background = '#f59e0b';
            resetBtn.style.color = 'white';
            resetBtn.style.border = 'none';
            resetBtn.style.borderRadius = '5px';
            resetBtn.style.cursor = 'pointer';
            resetBtn.onclick = resetAllData;
            
            const testBtn = document.createElement('button');
            testBtn.textContent = '‚ûï Test User';
            testBtn.style.padding = '8px 12px';
            testBtn.style.background = '#10b981';
            testBtn.style.color = 'white';
            testBtn.style.border = 'none';
            testBtn.style.borderRadius = '5px';
            testBtn.style.cursor = 'pointer';
            testBtn.onclick = addTestUser;
            
            debugContainer.appendChild(debugBtn);
            debugContainer.appendChild(resetBtn);
            debugContainer.appendChild(testBtn);
            document.body.appendChild(debugContainer);
        });
    </script>
    <script>
    // Mouse trail effect
    document.addEventListener('mousemove', function(e) {
        const trail = document.createElement('div');
        trail.className = 'mouse-trail';
        trail.style.left = e.pageX - 3 + 'px';
        trail.style.top = e.pageY - 3 + 'px';
        document.body.appendChild(trail);

        setTimeout(() => {
            trail.remove();
        }, 600);
    });
</script>
</body>

</html>
