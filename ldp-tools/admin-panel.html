<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LDP TOOLS - Admin Panel</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="light-beam"></div>
        <div class="light-beam"></div>
        <div class="light-beam"></div>
    </div>

    <!-- Header -->
    <header class="main-header">
        <div class="menu-icon" id="menuIcon">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <a href="home.html" class="logo">LDP TOOLS</a>
        <div class="user-info">
            <span class="username" id="headerUsername">Admin</span>
            <div class="balance-box" id="headerBalance">100,000,000ƒë</div>
        </div>
    </header>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <ul>
            <li onclick="window.location.href='home.html'">
                <i>üè†</i> Trang ch·ªß
            </li>
            <li onclick="window.location.href='#account'">
                <i>üë§</i> Ki·ªÉm tra t√†i kho·∫£n
            </li>
            <li onclick="window.location.href='deposit.html'">
                <i>üí∞</i> N·∫°p ti·ªÅn
            </li>
            <li onclick="showHistory()">
                <i>üìú</i> L·ªãch s·ª≠ mua
            </li>
            <li onclick="window.location.href='admin-panel.html'">
                <i>‚öôÔ∏è</i> Control Panel
            </li>
            <li onclick="logout()">
                <i>üö™</i> ƒêƒÉng xu·∫•t
            </li>
        </ul>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="admin-container">
            <div class="admin-header">
                <h1 class="admin-title">CONTROL PANEL</h1>
                <p class="admin-subtitle">Qu·∫£n l√Ω h·ªá th·ªëng LDP Tools</p>
            </div>

            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalUsers">0</div>
                    <div class="stat-label">T·ªïng ng∆∞·ªùi d√πng</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalRevenue">0ƒë</div>
                    <div class="stat-label">T·ªïng doanh thu</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="activeTools">0</div>
                    <div class="stat-label">Tool ƒëang ho·∫°t ƒë·ªông</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalVouchers">0</div>
                    <div class="stat-label">M√£ gi·∫£m gi√°</div>
                </div>
            </div>

            <!-- Admin Panels Grid -->
            <div class="admin-grid">
                <!-- User Management Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üë•</div>
                        <h3 class="panel-title">Danh S√°ch User</h3>
                    </div>
                    <div class="user-list" id="userList">
                        <div class="empty-state">
                            <div class="empty-icon">üë§</div>
                            <div class="empty-title">ƒêang t·∫£i...</div>
                        </div>
                    </div>
                </div>

                <!-- Transfer Money Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üí∏</div>
                        <h3 class="panel-title">Chuy·ªÉn Ti·ªÅn Cho User</h3>
                    </div>
                    <form class="admin-form" id="transferForm">
                        <div class="form-group">
                            <label>T√™n t√†i kho·∫£n ng∆∞·ªùi nh·∫≠n</label>
                            <input type="text" class="admin-input" id="transferUsername" placeholder="Nh·∫≠p username" required>
                        </div>
                        <div class="form-group">
                            <label>S·ªë ti·ªÅn chuy·ªÉn</label>
                            <input type="number" class="admin-input" id="transferAmount" placeholder="Nh·∫≠p s·ªë ti·ªÅn" min="1000" required>
                        </div>
                        <button type="submit" class="submit-btn">üí∞ Chuy·ªÉn ti·ªÅn ngay</button>
                    </form>
                </div>

                <!-- Ban User Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üö´</div>
                        <h3 class="panel-title">Ban User</h3>
                    </div>
                    <form class="admin-form" id="banForm">
                        <div class="form-group">
                            <label>T√™n t√†i kho·∫£n c·∫ßn ban</label>
                            <input type="text" class="admin-input" id="banUsername" placeholder="Nh·∫≠p username" required>
                        </div>
                        <div class="form-group">
                            <label>L√Ω do ban</label>
                            <textarea class="admin-input" id="banReason" placeholder="Nh·∫≠p l√Ω do..." rows="3"></textarea>
                        </div>
                        <button type="submit" class="submit-btn" style="background: var(--error-red);">üö´ Ban user n√†y</button>
                    </form>
                </div>

                <!-- Create Voucher Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üé´</div>
                        <h3 class="panel-title">T·∫°o M√£ Gi·∫£m Gi√°</h3>
                    </div>
                    <form class="admin-form" id="voucherForm">
                        <div class="form-group">
                            <label>Ch·ªçn tool</label>
                            <select class="admin-select" id="voucherTool" required>
                                <option value="toolv1">Tool V1</option>
                                <option value="toolmd5">Tool MD5</option>
                                <option value="toolsicbo">Tool Sicbo</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Ph·∫ßn trƒÉm gi·∫£m gi√°</label>
                            <input type="number" class="admin-input" id="voucherDiscount" placeholder="Nh·∫≠p % gi·∫£m gi√°" min="1" max="100" required>
                        </div>
                        <div class="form-group">
                            <label>Ng√†y h·∫øt h·∫°n</label>
                            <input type="date" class="admin-input" id="voucherExpiry" required>
                        </div>
                        <div class="form-group">
                            <label>S·ªë l∆∞·ª£t s·ª≠ d·ª•ng t·ªëi ƒëa</label>
                            <input type="number" class="admin-input" id="voucherMaxUses" placeholder="Nh·∫≠p s·ªë l∆∞·ª£t" min="1" required>
                        </div>
                        <button type="submit" class="submit-btn">üé´ T·∫°o voucher</button>
                    </form>
                </div>

                <!-- Voucher List Panel -->
                <div class="admin-panel">
                    <div class="panel-header">
                        <div class="panel-icon">üìã</div>
                        <h3 class="panel-title">Danh S√°ch Voucher</h3>
                    </div>
                    <div class="voucher-list" id="voucherList">
                        <div class="empty-state">
                            <div class="empty-icon">üé´</div>
                            <div class="empty-title">Ch∆∞a c√≥ voucher n√†o</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Notification -->
    <div id="notification" class="notification">
        <div class="notification-icon">‚úì</div>
        <div class="notification-content">
            <div class="notification-title">Th√¥ng b√°o</div>
            <div class="notification-message">Message here</div>
        </div>
    </div>

    <script>
        // Debug: Ki·ªÉm tra xem script ƒë√£ ch·∫°y ch∆∞a
        console.log('Admin panel script loaded');

        // Kh·ªüi t·∫°o d·ªØ li·ªáu n·∫øu ch∆∞a c√≥
        function initializeData() {
            if (!localStorage.getItem('users')) {
                const users = [
                    {
                        username: 'bevis',
                        password: 'leduc',
                        balance: 100000000,
                        isAdmin: true,
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('users', JSON.stringify(users));
                console.log('Initialized default admin user');
            }
        }

        // C·∫≠p nh·∫≠t th√¥ng tin header
        function updateHeaderInfo(user) {
            const usernameEl = document.getElementById('headerUsername');
            const balanceEl = document.getElementById('headerBalance');
            
            if (usernameEl) usernameEl.textContent = user.username;
            if (balanceEl) balanceEl.textContent = formatCurrency(user.balance);
        }

        // ƒê·ªãnh d·∫°ng ti·ªÅn t·ªá
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(amount);
        }

        // Kh·ªüi t·∫°o sidebar
        function initSidebar() {
            const menuIcon = document.getElementById('menuIcon');
            const sidebar = document.getElementById('sidebar');
            
            if (menuIcon && sidebar) {
                menuIcon.addEventListener('click', function() {
                    sidebar.classList.toggle('active');
                });
            }
        }

        // T·∫£i danh s√°ch user
        function loadUsersList() {
            console.log('Loading users list...');
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const userList = document.getElementById('userList');
            
            if (!userList) {
                console.error('User list element not found');
                return;
            }

            // L·ªçc ch·ªâ user th∆∞·ªùng (kh√¥ng ph·∫£i admin)
            const regularUsers = users.filter(user => !user.isAdmin);
            
            if (regularUsers.length === 0) {
                userList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üë§</div>
                        <div class="empty-title">Ch∆∞a c√≥ ng∆∞·ªùi d√πng th∆∞·ªùng</div>
                    </div>
                `;
                return;
            }
            
            userList.innerHTML = '';
            regularUsers.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'user-item';
                userItem.innerHTML = `
                    <div class="user-details">
                        <div class="user-name">${user.username}</div>
                        <div class="user-balance">${formatCurrency(user.balance)}</div>
                        <div class="user-date">ƒêƒÉng k√Ω: ${new Date(user.createdAt).toLocaleDateString('vi-VN')}</div>
                    </div>
                    <div class="user-actions">
                        <button class="action-btn edit" onclick="editUser('${user.username}')">S·ª≠a</button>
                        <button class="action-btn delete" onclick="deleteUser('${user.username}')">X√≥a</button>
                    </div>
                `;
                userList.appendChild(userItem);
            });
        }

        // C·∫≠p nh·∫≠t th·ªëng k√™
        function updateStats() {
            const users = JSON.parse(localStorage.getItem('users')) || [];
            const tools = JSON.parse(localStorage.getItem('tools')) || {};
            
            const totalUsers = users.filter(u => !u.isAdmin).length;
            let totalRevenue = 0;
            users.forEach(user => {
                if (!user.isAdmin) {
                    totalRevenue += user.balance;
                }
            });
            
            const activeTools = Object.values(tools).filter(tool => tool.active && tool.expiry > Date.now()).length;
            
            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalRevenue').textContent = formatCurrency(totalRevenue);
            document.getElementById('activeTools').textContent = activeTools;
            document.getElementById('totalVouchers').textContent = '0';
        }

        // X·ª≠ l√Ω chuy·ªÉn ti·ªÅn
        function handleTransfer(e) {
            e.preventDefault();
            console.log('Handling transfer...');
            
            const username = document.getElementById('transferUsername').value.trim();
            const amount = parseInt(document.getElementById('transferAmount').value);
            
            if (!username || isNaN(amount) || amount < 1000) {
                showNotification('Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin!', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.username === username);
            
            if (userIndex === -1) {
                showNotification('Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng!', 'error');
                return;
            }
            
            if (users[userIndex].isAdmin) {
                showNotification('Kh√¥ng th·ªÉ chuy·ªÉn ti·ªÅn cho admin!', 'error');
                return;
            }
            
            // C·ªông ti·ªÅn cho user
            users[userIndex].balance += amount;
            localStorage.setItem('users', JSON.stringify(users));
            
            showNotification(`ƒê√£ chuy·ªÉn ${formatCurrency(amount)} cho ${username}`);
            document.getElementById('transferForm').reset();
            loadUsersList();
            updateStats();
        }

        // X·ª≠ l√Ω ban user
        function handleBanUser(e) {
            e.preventDefault();
            console.log('Handling ban user...');
            
            const username = document.getElementById('banUsername').value.trim();
            const reason = document.getElementById('banReason').value.trim();
            
            if (!username) {
                showNotification('Vui l√≤ng nh·∫≠p t√™n ng∆∞·ªùi d√πng!', 'error');
                return;
            }
            
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.username === username);
            
            if (userIndex === -1) {
                showNotification('Kh√¥ng t√¨m th·∫•y ng∆∞·ªùi d√πng!', 'error');
                return;
            }
            
            if (users[userIndex].isAdmin) {
                showNotification('Kh√¥ng th·ªÉ ban admin!', 'error');
                return;
            }
            
            if (!confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën ban user ${username}?`)) {
                return;
            }
            
            users.splice(userIndex, 1);
            localStorage.setItem('users', JSON.stringify(users));
            
            showNotification(`ƒê√£ ban user ${username}`);
            document.getElementById('banForm').reset();
            loadUsersList();
            updateStats();
        }

        // X·ª≠ l√Ω t·∫°o voucher
        function handleCreateVoucher(e) {
            e.preventDefault();
            showNotification('T√≠nh nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...');
        }

        // Hi·ªÉn th·ªã th√¥ng b√°o
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const messageEl = notification.querySelector('.notification-message');
            
            messageEl.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ƒêƒÉng xu·∫•t
        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'index.html';
        }

        // Hi·ªÉn th·ªã l·ªãch s·ª≠
        function showHistory() {
            showNotification('T√≠nh nƒÉng ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn...');
        }

        // S·ª≠a user
        function editUser(username) {
            const users = JSON.parse(localStorage.getItem('users'));
            const userIndex = users.findIndex(u => u.username === username);
            
            if (userIndex !== -1) {
                const newBalance = prompt(`Nh·∫≠p s·ªë ti·ªÅn m·ªõi cho ${username}:`, users[userIndex].balance);
                if (newBalance !== null) {
                    users[userIndex].balance = parseInt(newBalance) || 0;
                    localStorage.setItem('users', JSON.stringify(users));
                    showNotification(`ƒê√£ c·∫≠p nh·∫≠t s·ªë ti·ªÅn cho ${username}`);
                    loadUsersList();
                    updateStats();
                }
            }
        }

        // X√≥a user
        function deleteUser(username) {
            if (confirm(`B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a user ${username}?`)) {
                const users = JSON.parse(localStorage.getItem('users'));
                const userIndex = users.findIndex(u => u.username === username);
                
                if (userIndex !== -1) {
                    users.splice(userIndex, 1);
                    localStorage.setItem('users', JSON.stringify(users));
                    showNotification(`ƒê√£ x√≥a user ${username}`);
                    loadUsersList();
                    updateStats();
                }
            }
        }

        // Kh·ªüi t·∫°o admin panel
        function initAdminPanel() {
            console.log('Initializing admin panel...');
            initializeData();
            
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (!currentUser || !currentUser.isAdmin) {
                alert('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p!');
                window.location.href = 'index.html';
                return;
            }
            
            updateHeaderInfo(currentUser);
            initSidebar();
            loadUsersList();
            updateStats();
            
            // G√°n s·ª± ki·ªán cho c√°c form
            document.getElementById('transferForm').addEventListener('submit', handleTransfer);
            document.getElementById('banForm').addEventListener('submit', handleBanUser);
            document.getElementById('voucherForm').addEventListener('submit', handleCreateVoucher);
            
            console.log('Admin panel initialized');
        }

        // Ch·∫°y khi trang ƒë√£ t·∫£i xong
        document.addEventListener('DOMContentLoaded', initAdminPanel);
    </script>
</body>
</html>